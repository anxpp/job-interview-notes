<!-- TOC -->

- [背景](#%E8%83%8C%E6%99%AF)
    - [IT新基建提升资源使用率](#it%E6%96%B0%E5%9F%BA%E5%BB%BA%E6%8F%90%E5%8D%87%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E7%8E%87)
    - [现状](#%E7%8E%B0%E7%8A%B6)
- [目标](#%E7%9B%AE%E6%A0%87)
    - [成本控制](#%E6%88%90%E6%9C%AC%E6%8E%A7%E5%88%B6)
    - [业务支撑](#%E4%B8%9A%E5%8A%A1%E6%94%AF%E6%92%91)
- [容量管理分类](#%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E5%88%86%E7%B1%BB)
- [资源容量管理](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
    - [规划资源容量管理](#%E8%A7%84%E5%88%92%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
        - [资源容量管理流程定义](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89)
    - [资源容量管理的过程](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E8%BF%87%E7%A8%8B)
    - [资源容量管理的执行](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E6%89%A7%E8%A1%8C)
    - [资源容量管理的监控](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E7%9B%91%E6%8E%A7)
    - [资源容量管理的分析](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%86%E6%9E%90)
        - [混合部署](#%E6%B7%B7%E5%90%88%E9%83%A8%E7%BD%B2)
        - [扩容](#%E6%89%A9%E5%AE%B9)
        - [回收](#%E5%9B%9E%E6%94%B6)
        - [容灾级别分析](#%E5%AE%B9%E7%81%BE%E7%BA%A7%E5%88%AB%E5%88%86%E6%9E%90)
    - [资源容量管理的调整](#%E8%B5%84%E6%BA%90%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E8%B0%83%E6%95%B4)
        - [混合部署的调整](#%E6%B7%B7%E5%90%88%E9%83%A8%E7%BD%B2%E7%9A%84%E8%B0%83%E6%95%B4)
        - [扩容](#%E6%89%A9%E5%AE%B9)
        - [回收](#%E5%9B%9E%E6%94%B6)
- [服务容量管理](#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
    - [服务容量管理的过程](#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E8%BF%87%E7%A8%8B)
    - [规划服务容量管理](#%E8%A7%84%E5%88%92%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
    - [服务容量计划与实施](#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E8%AE%A1%E5%88%92%E4%B8%8E%E5%AE%9E%E6%96%BD)
    - [服务容量监控](#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%9B%91%E6%8E%A7)
    - [服务容量分析和优化](#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E5%88%86%E6%9E%90%E5%92%8C%E4%BC%98%E5%8C%96)
    - [服务容量下线](#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%87%8F%E4%B8%8B%E7%BA%BF)
- [业务容量管理](#%E4%B8%9A%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
    - [业务容量管理的过程](#%E4%B8%9A%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E8%BF%87%E7%A8%8B)
    - [规划业务容量管理](#%E8%A7%84%E5%88%92%E4%B8%9A%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
    - [优化业务容量管理](#%E4%BC%98%E5%8C%96%E4%B8%9A%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
        - [调整容灾级别](#%E8%B0%83%E6%95%B4%E5%AE%B9%E7%81%BE%E7%BA%A7%E5%88%AB)
    - [控制业务容量管理](#%E6%8E%A7%E5%88%B6%E4%B8%9A%E5%8A%A1%E5%AE%B9%E9%87%8F%E7%AE%A1%E7%90%86)
- [成本](#%E6%88%90%E6%9C%AC)
    - [成本预算](#%E6%88%90%E6%9C%AC%E9%A2%84%E7%AE%97)
    - [成本分析](#%E6%88%90%E6%9C%AC%E5%88%86%E6%9E%90)
- [参考资料](#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99)

<!-- /TOC -->

## 背景

### IT新基建提升资源使用率

IT新基建提升资源使用率的背景下，需要不断提升服务器、容器资源使用率，排除一些例外规则（如高可用等），整体资源使用率

### 现状

[请问IT系统的容量管理应该如何规划 ?](https://www.zhihu.com/question/55363083)

- 对整体容量资产分部、剩余容量占比、容量趋势及容量预警进行展示
- 容量规划无依据，新系统上线、IT资源扩容无预测分析手段
- 缺乏业务和系统视角的容量指标体系，无法准确反映业务和系统所分配的IT资源
- 缺乏当前容量资源与业务需求相匹配的分析手段；容量采集手段混乱无序，指标体系不完善，管理规范化不足。
- 资源分配易，回收难，造成容量实际利用率远低于当前值
- 没有可靠的成本分析途径

## 目标

### 成本控制

容量主动管理和优化，降低IT资源投入

### 业务支撑

预测业务峰值增长，容量自适应

## 容量管理分类

容量管理主要分资源容量管理、业务容量管理、服务容量管理

## 资源容量管理

    包括：机房、机架、集群、主机等

### 规划资源容量管理

#### 资源容量管理流程定义

相关流程包括：容量计划、容量实施、容量评估和优化、容量下线

### 资源容量管理的过程

![请问IT系统的容量管理应该如何规划 ?](持续容量管理框架.jpg)

- 执行：指定合适的阈值和基线
- 监控：监控不容维度的使用率数据，应用的性能数据
    - 使用率数据
    - 性能数据
- 分析：根据监控数据、设置的阈值和基线，分析出具容量优化的方案
    - 阈值和基线的设置
    - 容量优化报告
- 调整：根据容量分析执行可行的优化方案，完成后根据新的当前状态实施新的阈值和基线并以此循环
    - 回收
    - 扩容

容量管理是一个循环的过程，每个完整的过程执行结束，都需要根据调整后的容量信息重新定义阈值和基线

### 资源容量管理的执行

对于不同级别的容量规模，会定义不同的阈值和基线

执行过程主要是根据当前容量信息定义阈值和基线，这是分析过程的重要参考

### 资源容量管理的监控

监控过程主要监控容量的水位（使用率）变化，不同类别的容量有不同维度的评估维度

### 资源容量管理的分析

#### 混合部署

#### 扩容

#### 回收

#### 容灾级别分析

### 资源容量管理的调整

#### 混合部署的调整

#### 扩容

#### 回收

## 服务容量管理

### 服务容量管理的过程

服务容量的管理存在于服务的整个生命周期

- 规划服务容量管理
- 服务容量计划与实施
- 服务容量监控
- 服务容量分析与优化
- 服务容量下线

### 规划服务容量管理

针对不同类型的服务，规划合适的维度

| 服务类型   | 参考维度       |
|--------|------------|
| 数据库    | 存储、CPU、内存、 |
| WEB服务  |            |
| 缓存     |            |
| 消息队列   |            |
| ...... |            |

### 服务容量计划与实施

根据服务的类型和性质，估算各类资源的用量，并输出服务容量计划表

对容量计划评估通过后，实施该容量计划

### 服务容量监控

针对不同类型的服务，监控各个维度的指标

### 服务容量分析和优化

### 服务容量下线

服务下线可由不同场景触发：

- 主动下线：由业务方主动发起的下线操作，相关资源可以直接回收
- 被动下线：由分析过程而确定服务已不再使用，通知业务方确认并下线

*主动下线流程*

*被动下线流程*

服务下线，回收相应的容量

## 业务容量管理

### 业务容量管理的过程

主要有规划容量管理，优化容量管理、控制容量管理

### 规划业务容量管理

### 优化业务容量管理

#### 调整容灾级别

### 控制业务容量管理

## 成本

### 成本预算

### 成本分析

    服务、业务、资源

## 参考资料

[请问IT系统的容量管理应该如何规划 ?](https://www.zhihu.com/question/55363083)

[容量管理](https://zhuanlan.zhihu.com/p/463930536)

[IStorM CM容量管理平台](https://www.hatech.com.cn/h-pd-48.html)

[IStorM CM 容量管理](https://www.hatech.com.cn/h-col-174.html)

[云容量管理和应用](https://cloud.tencent.com/developer/article/1400119)

[云容量管理的重要性以及如何进行](https://www.techtarget.com/searchcloudcomputing/feature/The-importance-of-cloud-capacity-management-and-how-to-do-it#:~:text=Cloud%20capacity%20management%20is%20critical%20to%20an%20effective,that%20waste%20money%20and%20add%20unnecessary%20management%20overhead.)

[Intelligent Cloud Capacity Management]()

[智能云容量管理](https://www.researchgate.net/publication/236335710_Intelligent_Cloud_Capacity_Management)

[https://www.researchgate.net/publication/236335710_Intelligent_Cloud_Capacity_Management](https://www.intel.com/content/dam/www/public/us/en/documents/white-papers/simplifying-private-cloud-capacity-management-paper-l.pdf)

[kubecost](https://github.com/kubecost/cost-model)

[如何在云原生混部场景下利用资源配额高效分配集群资源](https://zhuanlan.zhihu.com/p/504681375)
